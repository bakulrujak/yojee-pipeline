---
version: 0.2

phases:
  install:
    commands:
      - echo "Installing tools..."
      - export LC_ALL=en_US.UTF-8; export LANG=en_US.UTF-8; export LANGUAGE=en_US.UTF-8
      - wget https://packages.erlang-solutions.com/erlang-solutions_1.0_all.deb && dpkg -i erlang-solutions_1.0_all.deb
      - echo "deb http://binaries.erlang-solutions.com/ubuntu $(lsb_release -cs) contrib" > /etc/apt/sources.list.d/erlang-solutions.list
      - curl -sL https://deb.nodesource.com/setup_9.x | bash -
      - apt-get install -y --no-install-recommends erlang-dev erlang-parsetools erlang-xmerl elixir nodejs 
      - echo "Installing deps for your project..."
      - mix local.rebar --force
      - mix local.hex --force
      - mix deps.get
  pre_build:
    commands:
      - docker run -p 5432:5432 -e POSTGRES_PASSWORD=d0ntt3ll -d postgres
      - mix ecto.create
      - mix ecto.migrate
      - mix test
  build:
    commands:
      - cd assets && npm install      
      - mix release.init
      - mix release
artifacts:
  files:
    - yojee_*.tar.gz
  discard-paths: yes
  base-directory: _build/*/rel/*/releases/*/